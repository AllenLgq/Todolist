function addData(e){var n=db.transaction(["user"],"readwrite"),t=n.objectStore("user"),o=t.add(e);o.onerror=function(){console.log("failed")},o.onsuccess=function(){console.log("add success")}}function delAllData(){var e=request.result.transaction(["user"],"readwrite"),n=e.objectStore("user"),t=IDBKeyRange.lowerBound(0,!0);n.openCursor(t,"next").onsuccess=function(e){var n=e.target.result;if(n){var t=n.delete();t.onsuccess=function(){console.log("del success"),showData()},t.onerror=function(){console.log("del fail")},n.continue()}}}function delPanel(e){console.log(db);var n=db.transaction("user","readwrite"),t=n.objectStore("user");console.log(typeof e),t.delete(Number(e)).onsuccess=function(e){console.log("del success")}}function getId(){var e=db.transaction(["user"],"readwrite"),n=e.objectStore("user"),t=IDBKeyRange.lowerBound(0);n.openCursor(t,"next").onsuccess=function(e){var n=e.target.result;n?(n.continue(),user_id=n.value.id):console.log(user_id)}}function showData(){clearAllNodes();var e=db.transaction(["user"],"readwrite"),n=e.objectStore("user"),t=IDBKeyRange.lowerBound(0,!0);n.openCursor(t,"next").onsuccess=function(e){var n=e.target.result;n?(refreshNode(n.value),console.log(n.value+"show"),n.continue()):console.log("done")}}function showDataDone(){clearAllNodes();var e=db.transaction(["user"],"readwrite"),n=e.objectStore("user"),t=IDBKeyRange.lowerBound(0,!0);n.openCursor(t,"next").onsuccess=function(e){var n=e.target.result;n&&(n.value.finished&&(console.log(n.value+"done"),refreshNode(n.value)),n.continue())}}function showDataTodo(){clearAllNodes();var e=db.transaction(["user"],"readwrite"),n=e.objectStore("user"),t=IDBKeyRange.lowerBound(0,!0);n.openCursor(t,"next").onsuccess=function(e){var n=e.target.result;n&&(n.value.finished||(console.log(n.value+"todo"),refreshNode(n.value)),n.continue())}}function refreshNode(e){var n=document.getElementById("showData"),t=document.createTextNode(e.user_date),o=document.createTextNode(e.user_event),s=document.createElement("div");s.classList.add("panel");var d=document.createElement("div");d.classList.add("panel-heading");var a=document.createElement("div");a.className="panel-body",e.finished?(a.classList.add("eventDone"),s.classList.add("panel-danger")):(a.classList.add("eventTodo"),s.classList.add("panel-info")),d.appendChild(t),a.appendChild(o),n.appendChild(s),s.appendChild(d),s.appendChild(a);var r=document.createElement("button");r.classList.add("btn-sm"),r.classList.add("panelDel");var i=document.createTextNode("delete");r.appendChild(i),d.appendChild(r),r.setAttribute("data-btnId",e.id),r.addEventListener("click",function(e){delPanel(e.target.getAttribute("data-btnId")),showData()},!1),a.addEventListener("click",function(){e.finished=!e.finished,e.finished?(a.classList.remove("eventTodo"),a.classList.add("eventDone"),s.classList.remove("panel-info"),s.classList.add("panel-danger")):(a.classList.remove("eventDone"),a.classList.add("eventTodo"),s.classList.remove("panel-danger"),s.classList.add("panel-info"));var n=db.transaction(["user"],"readwrite"),t=n.objectStore("user");e.finished=e.finished,console.log(e),t.put(e).onsuccess=function(e){console.log("修改数据成功")}},!1)}function clearAllNodes(){for(var e=document.getElementById("showData");e.hasChildNodes();)e.removeChild(e.firstChild)}function pressEnter(){document.getElementById("add").click(),clearInput(),event.returnValue=!1}function clearInput(){document.getElementById("item").value=""}function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?document.getElementById("Top").style.display="block":document.getElementById("Top").style.display="none"}var addList=function(){var e=setEvent();if(""==e.user_event)return!1;addData(e),refreshNode(e),clearInput()},setEvent=function(){console.log(user_id);var e=document.getElementById("item").value,n=new Date,t=n.Format("yyyy年MM月dd日 hh:mm:ss");user_id++;var o={id:user_id,user_event:e,finished:!1,user_date:t};return console.log(o),o};Date.prototype.Format=function(e){var n={"y+":this.getFullYear(),"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S+":this.getMilliseconds()};for(var t in n)if(new RegExp("("+t+")").test(e))if("y+"==t)e=e.replace(RegExp.$1,(""+n[t]).substr(4-RegExp.$1.length));else if("S+"==t){var o=RegExp.$1.length;o=1==o?3:o,e=e.replace(RegExp.$1,("00"+n[t]).substr((""+n[t]).length-1,o))}else e=e.replace(RegExp.$1,1==RegExp.$1.length?n[t]:("00"+n[t]).substr((""+n[t]).length));return e},window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,window.IDBCursor=window.IDBCursor||window||window.webkitIDBCursor||window.msIDBCursor;var cfg={dbname:"todolist",dbVersion:"1"};!function(){request=indexedDB.open(cfg.dbname,cfg.dbVersion),request.onerror=function(e){console.log("failed")},request.onsuccess=function(e){db=e.target.result,showData(),user_id=getId(),document.getElementById("done").addEventListener("click",function(){showDataDone()},!1),document.getElementById("todo").addEventListener("click",function(){showDataTodo()},!1),document.getElementById("all").addEventListener("click",function(){showData()},!1),document.getElementById("delete").addEventListener("click",function(){delAllData()},!1)},request.onupgradeneeded=function(e){if(db=e.target.result,!db.objectStoreNames.contains("user"))var n=db.createObjectStore("user",{keyPath:"id",autoIncrement:!0});n.add({id:0,user_event:0,finished:!0,date:0})}}(),document.getElementById("item").addEventListener("keydown",function(e){13==e.keyCode&&pressEnter()},!1),window.onscroll=function(){scrollFunction()},document.getElementById("Top").addEventListener("click",function(){document.body.scrollTop=0,document.documentElement.scrollTop=0},!1);